<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>bcbioRNASeq • bcbioRNASeq</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="bcbioRNASeq">
<meta property="og:description" content="bcbioRNASeq">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bcbioRNASeq</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.34</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/bcbioRNASeq.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/hbc/bcbioRNASeq/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="bcbioRNASeq_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>bcbioRNASeq</h1>
            
            <h4 class="date">8 July 2020</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/hbc/bcbioRNASeq/blob/master/vignettes/bcbioRNASeq.Rmd"><code>vignettes/bcbioRNASeq.Rmd</code></a></small>
      <div class="hidden name"><code>bcbioRNASeq.Rmd</code></div>

    </div>

    
        <div class="abstract">
      <p class="abstract">Abstract</p>
      <p>RNA-seq analysis involves multiple steps from processing raw sequencing data to identifying, organizing, annotating, and reporting differentially expressed genes. bcbio is an open source, community-maintained framework providing automated and scalable RNA-seq methods for identifying gene abundance counts. We have developed bcbioRNASeq, a Bioconductor package that provides ready-to-render templates and wrapper functions to post-process bcbio output data. bcbioRNASeq automates the generation of high-level RNA-seq reports, including identification of differentially expressed genes, functional enrichment analysis and quality control analysis.</p>
    </div>
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>For a high-level overview of our <a href="https://bcbio-nextgen.readthedocs.io/">bcbio</a> RNA-seq analysis pipeline, including detailed explanation of the <code>bcbioRNASeq</code> S4 class definition, first consult our <a href="http://dx.doi.org/10.12688/f1000research.12093.2">workflow paper</a> published in <em>F1000 Research</em> <span class="citation">(Steinbaugh et al. 2018)</span>. This vignette is focused on more advanced usage and edge cases that a user may encounter when attempting to load a bcbio dataset and perform downstream quality control analysis.</p>
<p><strong>Note:</strong> if you use <a href="https://bioinformatics.sph.harvard.edu/bcbioRNASeq/">bcbioRNASeq</a> in published research, please include this citation:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/citation.html">citation</a></span>(<span class="st">"bcbioRNASeq"</span>)</pre></body></html></div>
<pre><code>## 
## To cite bcbioRNASeq in publications use:
## 
##   Steinbaugh MJ, Pantano L, Kirchner RD, Barrera V, Chapman BA, Piper
##   ME, Mistry M, Khetani RS, Rutherford KD, Hoffman O, Hutchinson JN, Ho
##   Sui SJ. (2018). bcbioRNASeq: R package for bcbio RNA-seq analysis.
##   F1000Research, 6:1976. URL
##   https://f1000research.com/articles/6-1976/v2. DOI
##   10.12688/f1000research.12093.2.
## 
## A BibTeX entry for LaTeX users is
## 
##   @Article{,
##     title = {{bcbioRNASeq}: {R} package for bcbio {RNA-seq} analysis},
##     author = {Michael J. Steinbaugh and Lorena Pantano and Rory D. Kirchner and Victor Barrera and Brad A. Chapman and Mary E. Piper and Meeta Mistry and Radhika S. Khetani and Kayleigh D. Rutherford and Oliver Hofmann and John N. Hutchinson and Shannan J. Ho Sui},
##     journal = {F1000Research},
##     volume = {6},
##     number = {1976},
##     year = {2018},
##     url = {https://f1000research.com/articles/6-1976/v2},
##     doi = {10.12688/f1000research.12093.2},
##   }</code></pre>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">bcbioRNASeq</span>)</pre></body></html></div>
</div>
<div id="loading-bcbio-data" class="section level1">
<h1 class="hasAnchor">
<a href="#loading-bcbio-data" class="anchor"></a>Loading bcbio data</h1>
<p>The <code>bcbioRNASeq</code> constructor function is the main interface connecting bcbio] output data to interactive use in <a href="https://www.r-project.org/">R</a>. It is highly customizable and supports a number of options for advanced use cases. Consult the documentation for additional details.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/help.html">help</a></span>(<span class="kw">topic</span> <span class="kw">=</span> <span class="st">"bcbioRNASeq"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"bcbioRNASeq"</span>)</pre></body></html></div>
<div id="upload-directory" class="section level2">
<h2 class="hasAnchor">
<a href="#upload-directory" class="anchor"></a>Upload directory</h2>
<p>We have designed the constructor to work as simply as possible by default. The only required argument is <code>uploadDir</code>, the path to the bcbio final upload directory specified with <code>upload:</code> in the YAML configuration. Refer to the <a href="https://bcbio-nextgen.readthedocs.io/en/latest/contents/configuration.html">bcbio configuration</a> documentation for detailed information on how to set up a bcbio run, which is outside the scope of this vignette.</p>
<p>For example, let’s load up the example bcbio dataset stored internally in the package.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">uploadDir</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>, <span class="st">"bcbio"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"bcbioRNASeq"</span>)</pre></body></html></div>
<p>bcbio outputs RNA-seq data in a standardized directory structure, which is described in detail in our workflow paper.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span>(<span class="kw">path</span> <span class="kw">=</span> <span class="no">uploadDir</span>, <span class="kw">full.names</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">recursive</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<pre><code>##  [1] "2018-03-18_GSE65267-merged/bcbio-nextgen-commands.log"
##  [2] "2018-03-18_GSE65267-merged/bcbio-nextgen.log"         
##  [3] "2018-03-18_GSE65267-merged/combined.counts"           
##  [4] "2018-03-18_GSE65267-merged/programs.txt"              
##  [5] "2018-03-18_GSE65267-merged/project-summary.yaml"      
##  [6] "2018-03-18_GSE65267-merged/tx2gene.csv"               
##  [7] "control_rep1/salmon/quant.sf"                         
##  [8] "control_rep2/salmon/quant.sf"                         
##  [9] "control_rep3/salmon/quant.sf"                         
## [10] "fa_day7_rep1/salmon/quant.sf"                         
## [11] "fa_day7_rep2/salmon/quant.sf"                         
## [12] "fa_day7_rep3/salmon/quant.sf"                         
## [13] "sample_metadata.csv"</code></pre>
</div>
<div id="counts-level" class="section level2">
<h2 class="hasAnchor">
<a href="#counts-level" class="anchor"></a>Counts level</h2>
<p>By default, <a href="https://bioinformatics.sph.harvard.edu/bcbioRNASeq/">bcbioRNASeq</a> imports counts at gene level, which are required for standard differential expression analysis (<code>level = "genes"</code>). For pseudo-aligned counts (e.g. <a href="https://combine-lab.github.io/salmon/">Salmon</a>, <a href="https://pachterlab.github.io/kallisto/">Kallisto</a>, <a href="http://www.cs.cmu.edu/~ckingsf/software/sailfish/">Sailfish</a>) <span class="citation">(Bray et al. 2016; Patro, Mount, and Kingsford 2014; Patro et al. 2017)</span>, <a href="https://bioconductor.org/packages/tximport/">tximport</a> <span class="citation">(Soneson, Love, and Robinson 2016)</span> is used internally to aggregate transcript-level counts to gene-level counts, and generates length-scaled transcripts per million (TPM) values. For aligned counts processed with <a href="http://bioinf.wehi.edu.au/featureCounts/">featureCounts</a> <span class="citation">(Liao, Smyth, and Shi 2014)</span> (e.g. <a href="https://github.com/alexdobin/STAR/">STAR</a>, <a href="https://ccb.jhu.edu/software/hisat2/">HISAT2</a>) <span class="citation">(Dobin et al. 2013; Dobin and Gingeras 2016; Kim, Langmead, and Salzberg 2015)</span>, these values are already returned at gene level, and therefore not handled by <a href="https://bioconductor.org/packages/tximport/">tximport</a>. Once the gene-level counts are imported during the <code>bcbioRNASeq</code> call, the <a href="https://bioconductor.org/packages/DESeq2/">DESeq2</a> package <span class="citation">(Love, Huber, and Anders 2014)</span> is then used to generate an internal <code>DESeqDataSet</code> from which we derive normalized and variance-stabilized counts.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">object</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/bcbioRNASeq.html">bcbioRNASeq</a></span>(<span class="kw">uploadDir</span> <span class="kw">=</span> <span class="no">uploadDir</span>, <span class="kw">level</span> <span class="kw">=</span> <span class="st">"genes"</span>)</pre></body></html></div>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">object</span>)</pre></body></html></div>
<pre><code>## bcbioRNASeq 0.3.34
## uploadDir: /private/var/folders/l1/8y8sjzmn15v49jgrqglghcfr0000gn/T/RtmpBHbFxD/temp_libpath17262288beaaf/bcbioRNASeq/extdata/bcbio
## dates(2): [bcbio] 2018-03-18; [R] 2020-07-08
## level: genes
## caller: salmon
## organism: Mus musculus
## interestingGroups: sampleName
## class: RangedSummarizedExperiment 
## dim: 100 6 
## metadata(27): allSamples bcbioCommandsLog ... wd yaml
## assays(6): counts aligned ... normalized vst
## rownames(100): ENSMUSG00000000001 ENSMUSG00000000003 ...
##   ENSMUSG00000062661 ENSMUSG00000074340
## rowData names(0):
## colnames(6): control_rep1 control_rep2 ... fa_day7_rep2 fa_day7_rep3
## colData names(26): averageInsertSize averageReadLength ... treatment
##   x5x3Bias</code></pre>
<p>Alternatively, if you want to perform transcript-aware analysis, such as differential exon usage or splicing analysis, transcript-level counts can be obtained using <code>level = "transcripts"</code>. Note that when counts are loaded at transcript level, TPMs are generated with tximport internally, but no additional normalizations or transformations normally calculated for gene-level counts with DESeq2 are generated.</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">object</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/bcbioRNASeq.html">bcbioRNASeq</a></span>(<span class="kw">uploadDir</span> <span class="kw">=</span> <span class="no">uploadDir</span>, <span class="kw">level</span> <span class="kw">=</span> <span class="st">"transcripts"</span>, <span class="kw">fast</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">object</span>)</pre></body></html></div>
<pre><code>## bcbioRNASeq 0.3.34
## uploadDir: /private/var/folders/l1/8y8sjzmn15v49jgrqglghcfr0000gn/T/RtmpBHbFxD/temp_libpath17262288beaaf/bcbioRNASeq/extdata/bcbio
## dates(2): [bcbio] 2018-03-18; [R] 2020-07-08
## level: transcripts
## caller: salmon
## organism: Mus musculus
## interestingGroups: sampleName
## class: RangedSummarizedExperiment 
## dim: 100 6 
## metadata(27): allSamples bcbioCommandsLog ... wd yaml
## assays(3): counts avgTxLength tpm
## rownames(100): ENSMUST00000000001 ENSMUST00000000003 ...
##   ENSMUST00000000674 ENSMUST00000000687
## rowData names(0):
## colnames(6): control_rep1 control_rep2 ... fa_day7_rep2 fa_day7_rep3
## colData names(26): averageInsertSize averageReadLength ... treatment
##   x5x3Bias</code></pre>
</div>
<div id="expression-callers" class="section level2">
<h2 class="hasAnchor">
<a href="#expression-callers" class="anchor"></a>Expression callers</h2>
<p>Since bcbio is flexible and supports a number of expression callers, we have provided advanced options in the <code>bcbioRNASeq</code> constructor to support a variety of workflows using the <code>caller</code> argument. Salmon, Kallisto, and Sailfish counts are supported at either gene or transcript level. Internally, these are loaded using tximport. STAR and HISAT2 aligned counts processed with featureCounts are also supported, but only at gene level.</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">object</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/bcbioRNASeq.html">bcbioRNASeq</a></span>(<span class="kw">uploadDir</span> <span class="kw">=</span> <span class="no">uploadDir</span>, <span class="kw">caller</span> <span class="kw">=</span> <span class="st">"star"</span>, <span class="kw">fast</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">object</span>)</pre></body></html></div>
<pre><code>## bcbioRNASeq 0.3.34
## uploadDir: /private/var/folders/l1/8y8sjzmn15v49jgrqglghcfr0000gn/T/RtmpBHbFxD/temp_libpath17262288beaaf/bcbioRNASeq/extdata/bcbio
## dates(2): [bcbio] 2018-03-18; [R] 2020-07-08
## level: genes
## caller: star
## organism: Mus musculus
## interestingGroups: sampleName
## class: RangedSummarizedExperiment 
## dim: 100 6 
## metadata(25): allSamples bcbioCommandsLog ... wd yaml
## assays(1): counts
## rownames(100): ENSMUSG00000000001 ENSMUSG00000000003 ...
##   ENSMUSG00000000563 ENSMUSG00000000567
## rowData names(0):
## colnames(6): control_rep1 control_rep2 ... fa_day7_rep2 fa_day7_rep3
## colData names(26): averageInsertSize averageReadLength ... treatment
##   x5x3Bias</code></pre>
</div>
<div id="sample-selection-and-metadata" class="section level2">
<h2 class="hasAnchor">
<a href="#sample-selection-and-metadata" class="anchor"></a>Sample selection and metadata</h2>
<p>If you’d like to load up only a subset of samples, this can be done easily using the <code>samples</code> argument. Note that the <code>character</code> vector declared here must match the <code>description</code> column specified in the sample metadata. Conversely, if you’re working with a large dataset and you simply want to drop a few samples, this can be accomplished with the <code>censorSamples</code> argument.</p>
<p>When working with a bcbio run that has incorrect or outdated metadata, the simplest way to fix this issue is to pass in new metadata from an external spreadsheet (CSV or Excel) using the <code>sampleMetadataFile</code> argument. Note that this can also be used to subset the bcbio dataset, similar to the <code>samples</code> argument (see above), based on the rows that are included in the spreadsheet.</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">sampleMetadataFile</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="no">uploadDir</span>, <span class="st">"sample_metadata.csv"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html">stopifnot</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span>(<span class="no">sampleMetadataFile</span>))
<span class="fu">import</span>(<span class="kw">file</span> <span class="kw">=</span> <span class="no">sampleMetadataFile</span>)</pre></body></html></div>
<pre><code>##                   fileName  description  treatment day
## 1 control_rep1_R1.fastq.gz control_rep1    control   0
## 2 control_rep2_R1.fastq.gz control_rep2    control   0
## 3 control_rep3_R1.fastq.gz control_rep3    control   0
## 4 fa_day7_rep1_R1.fastq.gz fa_day7_rep1 folic acid   7
## 5 fa_day7_rep2_R1.fastq.gz fa_day7_rep2 folic acid   7
## 6 fa_day7_rep3_R1.fastq.gz fa_day7_rep3 folic acid   7</code></pre>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="no">object</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/bcbioRNASeq.html">bcbioRNASeq</a></span>(
    <span class="kw">uploadDir</span> <span class="kw">=</span> <span class="no">uploadDir</span>,
    <span class="kw">sampleMetadataFile</span> <span class="kw">=</span> <span class="no">sampleMetadataFile</span>,
    <span class="kw">fast</span> <span class="kw">=</span> <span class="fl">TRUE</span>
)</pre></body></html></div>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="fu">sampleData</span>(<span class="no">object</span>)</pre></body></html></div>
<pre><code>## DataFrame with 6 rows and 5 columns
##                   day                 fileName   sampleName  treatment
##              &lt;factor&gt;                 &lt;factor&gt;     &lt;factor&gt;   &lt;factor&gt;
## control_rep1        0 control_rep1_R1.fastq.gz control_rep1 control   
## control_rep2        0 control_rep2_R1.fastq.gz control_rep2 control   
## control_rep3        0 control_rep3_R1.fastq.gz control_rep3 control   
## fa_day7_rep1        7 fa_day7_rep1_R1.fastq.gz fa_day7_rep1 folic acid
## fa_day7_rep2        7 fa_day7_rep2_R1.fastq.gz fa_day7_rep2 folic acid
## fa_day7_rep3        7 fa_day7_rep3_R1.fastq.gz fa_day7_rep3 folic acid
##              interestingGroups
##                       &lt;factor&gt;
## control_rep1      control_rep1
## control_rep2      control_rep2
## control_rep3      control_rep3
## fa_day7_rep1      fa_day7_rep1
## fa_day7_rep2      fa_day7_rep2
## fa_day7_rep3      fa_day7_rep3</code></pre>
</div>
<div id="genome-annotations" class="section level2">
<h2 class="hasAnchor">
<a href="#genome-annotations" class="anchor"></a>Genome annotations</h2>
<p>When analyzing a dataset against a well-annotated genome, we recommend importing the corresponding metadata using <a href="https://bioconductor.org/packages/AnnotationHub/">AnnotationHub</a> and <a href="https://bioconductor.org/packages/ensembldb/">ensembldb</a>. This functionality is natively supported in the <code>bcbioRNASeq</code> constructor with using the <code>organism</code>, <code>ensemblRelease</code>, and <code>genomeBuild</code> arguments. For example, with our internal bcbio dataset, we’re analyzing counts generated against the <a href="https://www.ensembl.org/">Ensembl</a> <em>Mus musculus</em> GRCm38 genome build (release 87). These parameters can be defined in the object load call to ensure that the annotations match up exactly with the genome used.</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="no">object</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/bcbioRNASeq.html">bcbioRNASeq</a></span>(
    <span class="kw">uploadDir</span> <span class="kw">=</span> <span class="no">uploadDir</span>,
    <span class="kw">level</span> <span class="kw">=</span> <span class="st">"genes"</span>,
    <span class="kw">organism</span> <span class="kw">=</span> <span class="st">"Mus musculus"</span>,
    <span class="kw">genomeBuild</span> <span class="kw">=</span> <span class="st">"GRCm38"</span>,
    <span class="kw">ensemblRelease</span> <span class="kw">=</span> <span class="fl">87</span>
)</pre></body></html></div>
<p>This will return a <code>GRanges</code> object using the <a href="https://bioconductor.org/packages/GenomicRanges/">GenomicRanges</a> package <span class="citation">(Lawrence et al. 2013)</span>, which contains coordinates and rich metadata for each gene or transcript. These annotations are accessible with the <code>rowRanges</code> and <code>rowData</code> functions defined in the <a href="https://bioconductor.org/packages/SummarizedExperiment/">SummarizedExperiment</a> package <span class="citation">(Huber et al. 2015)</span>.</p>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="fu">rowRanges</span>(<span class="no">object</span>))</pre></body></html></div>
<pre><code>## [1] "GRanges object with 100 ranges and 7 metadata columns"</code></pre>
<div class="sourceCode" id="cb25"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="fu">rowData</span>(<span class="no">object</span>))</pre></body></html></div>
<pre><code>## [1] "DataFrame object of length 7 with 0 metadata columns"</code></pre>
<p>Alternatively, transcript-level annotations can also be obtained automatically using this method.</p>
<p>When working with a dataset generated against a poorly-annotated or non-standard genome, we provide a fallback method for loading gene annotations from a <a href="https://useast.ensembl.org/info/website/upload/gff.html">general feature format (GFF)</a> file with the <code>gffFile</code> argument. If possible, we recommend providing a general transfer format (GTF) file, which is identical to GFF version 2. GFFv3 is more complicated and non-standard, but Ensembl GFFv3 files are also supported.</p>
<p>If your dataset contains transgenes (e.g. EGFP, TDTOMATO), these features can be defined with the <code>transgeneNames</code> argument, which will automatically populate the <code>rowRanges</code> slot with placeholder metadata.</p>
<p>We recommend loading up data per genome in its own <code>bcbioRNASeq</code> object when possible, so that rich metadata can be imported easily. In the edge case where you need to look at multiple genomes simultaneously, set <code>organism = NULL</code>, and bcbioRNASeq will skip the gene annotation acquisition step.</p>
<p>Refer to the the <a href="https://bioconductor.org/packages/GenomicRanges/">GenomicRanges</a> and <a href="https://bioconductor.org/packages/SummarizedExperiment/">SummarizedExperiment</a> package documentation for more details on working with the genome annotations defined in the <code>rowRanges</code> slot of the object. Here are some useful examples:</p>
<div class="sourceCode" id="cb27"><html><body><pre class="r"><span class="fu">seqnames</span>(<span class="no">object</span>)</pre></body></html></div>
<pre><code>## factor-Rle of length 100 with 64 runs
##   Lengths:  1  1  1  1  1  1  1  1  5  1  1 ...  1  1  1  2  1  1  1  1  2  1
##   Values :  3  X 16 11  6 13  4  9 11 17  5 ...  6  5  9 11  8 11  7 15  2  3
## Levels(86): 3 X 16 7 ... CHR_MG3836_PATCH CHR_MG3496_PATCH CHR_MG3172_PATCH</code></pre>
<div class="sourceCode" id="cb29"><html><body><pre class="r"><span class="fu">ranges</span>(<span class="no">object</span>)</pre></body></html></div>
<pre><code>## IRanges object with 100 ranges and 0 metadata columns:
##                          start       end     width
##                      &lt;integer&gt; &lt;integer&gt; &lt;integer&gt;
##   ENSMUSG00000000001 108107280 108146146     38867
##   ENSMUSG00000000003  77837901  77853623     15723
##   ENSMUSG00000000028  18780447  18811987     31541
##   ENSMUSG00000000049 108343354 108414396     71043
##   ENSMUSG00000000058  17281185  17289115      7931
##                  ...       ...       ...       ...
##   ENSMUSG00000048583 142650766 142666816     16051
##   ENSMUSG00000055022  92051165  92341967    290803
##   ENSMUSG00000061689 156613705 156764363    150659
##   ENSMUSG00000062661  31245823  31295989     50167
##   ENSMUSG00000074340 105973711 105987423     13713</code></pre>
<div class="sourceCode" id="cb31"><html><body><pre class="r"><span class="fu">strand</span>(<span class="no">object</span>)</pre></body></html></div>
<pre><code>## factor-Rle of length 100 with 42 runs
##   Lengths: 3 7 1 3 2 2 1 2 3 1 2 6 2 3 2 3 ... 2 3 1 4 1 1 2 2 2 4 2 2 1 4 2 4
##   Values : - + - + - + - + - + - + - + - + ... - + - + - + - + - + - + - + - +
## Levels(3): + - *</code></pre>
</div>
<div id="variance-stabilization" class="section level2">
<h2 class="hasAnchor">
<a href="#variance-stabilization" class="anchor"></a>Variance stabilization</h2>
<p>During the <code>bcbioRNASeq</code> constructor call, log2 variance stabilizaton of gene-level counts can be calculated automatically, and is recommended. This is performed internally by the DESeq2 package, using the <code>varianceStabilizingTransformation</code> and/or <code>rlog</code> functions. These transformations will be slotted into <code>assays</code>.</p>
<div class="sourceCode" id="cb33"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="fu"><a href="../reference/counts.html">counts</a></span>(<span class="no">object</span>, <span class="kw">normalized</span> <span class="kw">=</span> <span class="st">"vst"</span>))</pre></body></html></div>
<pre><code>##   control_rep1     control_rep2     control_rep3     fa_day7_rep1   
##  Min.   : 4.919   Min.   : 4.919   Min.   : 4.919   Min.   : 4.919  
##  1st Qu.: 4.919   1st Qu.: 4.919   1st Qu.: 4.919   1st Qu.: 4.919  
##  Median : 6.051   Median : 5.658   Median : 6.009   Median : 6.237  
##  Mean   : 6.713   Mean   : 6.706   Mean   : 6.715   Mean   : 6.762  
##  3rd Qu.: 7.990   3rd Qu.: 8.239   3rd Qu.: 7.815   3rd Qu.: 8.239  
##  Max.   :12.215   Max.   :12.972   Max.   :11.818   Max.   :11.764  
##   fa_day7_rep2     fa_day7_rep3   
##  Min.   : 4.919   Min.   : 4.919  
##  1st Qu.: 5.101   1st Qu.: 4.919  
##  Median : 6.216   Median : 6.185  
##  Mean   : 6.754   Mean   : 6.789  
##  3rd Qu.: 8.033   3rd Qu.: 7.930  
##  Max.   :12.086   Max.   :11.997</code></pre>
</div>
</div>
<div id="use-case-dataset" class="section level1">
<h1 class="hasAnchor">
<a href="#use-case-dataset" class="anchor"></a>Use case dataset</h1>
<p>To demonstrate the functionality and configuration of the package, we have taken an experiment from the <a href="https://www.ncbi.nlm.nih.gov/geo/">Gene Expression Omnibus (GEO)</a> public repository of expression data to use as an example use case. The RNA-seq data is from a study of acute kidney injury in a mouse model (<a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE65267">GSE65267</a>) <span class="citation">(Craciun et al. 2016)</span>. The study aims to identify differentially expressed genes in progressive kidney fibrosis and contains samples from mouse kidneys at several time points (n = 3, per time point) after folic acid treatment. From this dataset, we are using a subset of the samples for our use case: before folic acid treatment, and 1, 3, 7 days after treatment.</p>
<p>For the vignette, we are loading a pre-computed version of the example <code>bcbioRNASeq</code> object used in our workflow paper.</p>
<div class="sourceCode" id="cb35"><html><body><pre class="r"><span class="no">object</span> <span class="kw">&lt;-</span> <span class="fu">import</span>(<span class="kw">file</span> <span class="kw">=</span> <span class="fu">pasteURL</span>(
    <span class="st">"github.com"</span>, <span class="st">"hbc"</span>, <span class="st">"bcbioRNASeq"</span>,
    <span class="st">"raw"</span>, <span class="st">"f1000v2"</span>, <span class="st">"data"</span>, <span class="st">"bcb.rda"</span>,
    <span class="kw">protocol</span> <span class="kw">=</span> <span class="st">"https"</span>
))
<span class="no">object</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/updateObject.html">updateObject</a></span>(<span class="no">object</span>)
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">object</span>)</pre></body></html></div>
<pre><code>## bcbioRNASeq 0.3.34
## uploadDir: /n/data1/cores/bcbio/bcbioRNASeq/F1000v2/GSE65267-merged/final
## dates(2): [bcbio] 2018-03-18; [R] 2018-06-01
## level: genes
## caller: salmon
## organism: Mus musculus
## interestingGroups: day
## class: RangedSummarizedExperiment 
## dim: 51652 12 
## metadata(28): version level ... subset previousVersion
## assays(6): counts tpm ... rlog vst
## rownames(51652): ENSMUSG00000000001 ENSMUSG00000000003 ...
##   ENSMUSG00000114967 ENSMUSG00000114968
## rowData names(7): geneID geneName ... entrezID broadClass
## colnames(12): control_rep1 control_rep2 ... fa_day7_rep2 fa_day7_rep3
## colData names(25): sampleName day ... x5x3Bias xGC</code></pre>
</div>
<div id="sample-metadata" class="section level1">
<h1 class="hasAnchor">
<a href="#sample-metadata" class="anchor"></a>Sample metadata</h1>
<p>For reference, let’s take a look at the sample metadata. By comparison, using <code>colData</code> will return all sample-level metadata, including our quality control metrics generated by bcbio. We recommend instead using <code>sampleData</code> with the <code>clean = TRUE</code> argument in reports, which only returns <code>factor</code> columns of interest.</p>
<div class="sourceCode" id="cb37"><html><body><pre class="r"><span class="fu">sampleData</span>(<span class="no">object</span>)</pre></body></html></div>
<pre><code>## DataFrame with 12 rows and 7 columns
##                sampleName      day replicate   strain   tissue  treatment
##                  &lt;factor&gt; &lt;factor&gt;  &lt;factor&gt; &lt;factor&gt; &lt;factor&gt;   &lt;factor&gt;
## control_rep1 control_rep1        0         1   Balb/c   kidney control   
## control_rep2 control_rep2        0         2   Balb/c   kidney control   
## control_rep3 control_rep3        0         3   Balb/c   kidney control   
## fa_day1_rep1 fa_day1_rep1        1         1   Balb/c   kidney folic acid
## fa_day1_rep2 fa_day1_rep2        1         2   Balb/c   kidney folic acid
## ...                   ...      ...       ...      ...      ...        ...
## fa_day3_rep2 fa_day3_rep2        3         2   Balb/c   kidney folic acid
## fa_day3_rep3 fa_day3_rep3        3         3   Balb/c   kidney folic acid
## fa_day7_rep1 fa_day7_rep1        7         1   Balb/c   kidney folic acid
## fa_day7_rep2 fa_day7_rep2        7         2   Balb/c   kidney folic acid
## fa_day7_rep3 fa_day7_rep3        7         3   Balb/c   kidney folic acid
##              interestingGroups
##                       &lt;factor&gt;
## control_rep1                 0
## control_rep2                 0
## control_rep3                 0
## fa_day1_rep1                 1
## fa_day1_rep2                 1
## ...                        ...
## fa_day3_rep2                 3
## fa_day3_rep3                 3
## fa_day7_rep1                 7
## fa_day7_rep2                 7
## fa_day7_rep3                 7</code></pre>
</div>
<div id="interesting-groups" class="section level1">
<h1 class="hasAnchor">
<a href="#interesting-groups" class="anchor"></a>Interesting groups</h1>
<p>Groups of interest to be used for coloring and sample grouping in the quality control plots can be defined in the <code>bcbioRNASeq</code> object using the <code>interestingGroups</code> argument in the <code>bcbioRNASeq</code> constructor call. Assignment method support with the <code>interestingGroups</code> function is also provided, which can modify the groups of interest after the object has been created.</p>
<p>The <code>interestingGroups</code> definition defaults to <code>sampleName</code>, which is automatically generated from the bcbio <code>description</code> metadata for demultiplexed bulk RNA-seq samples. In this case, the samples will be grouped and colored uniquely.</p>
<p>Interesting groups must be defined using a <code>character</code> vector and refer to column names defined in the <code>colData</code> slot of the object. Note that the bcbioRNASeq package uses lower camel case formatting for column names (e.g. “sampleName”), so the interesting groups should be defined using camel case, not snake (e.g. “sample_name”) or dotted case (e.g. “sample.name”).</p>
<p>This approach was inspired by the DESeq2 package, which uses the argument <code>intgroup</code> in some functions, such as <code>plotPCA</code> for labeling groups of interest. We took this idea and ran with it for a number of our quality control functions, which are described in detail below.</p>
<div class="sourceCode" id="cb39"><html><body><pre class="r"><span class="fu">interestingGroups</span>(<span class="no">object</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"treatment"</span>, <span class="st">"day"</span>)</pre></body></html></div>
</div>
<div id="quality-control" class="section level1">
<h1 class="hasAnchor">
<a href="#quality-control" class="anchor"></a>Quality control</h1>
<p>Our workflow paper describes the quality control process in detail. In addition, our <strong>Quality Control</strong> <a href="https://rmarkdown.rstudio.com/">R Markdown</a> template contains notes detailing each metric. Here were are going into more technical detail regarding how to customize the appearance of the plots. Note that all quality control plotting functions inherit the <code>interestingGroups</code> defined inside the <code>bcbioRNASeq</code> object. You can also change this dynamially for each function call using the <code>interestingGroups</code> argument.</p>
<div id="read-counts" class="section level2">
<h2 class="hasAnchor">
<a href="#read-counts" class="anchor"></a>Read counts</h2>
<div class="sourceCode" id="cb40"><html><body><pre class="r"><span class="fu"><a href="../reference/plotTotalReads.html">plotTotalReads</a></span>(<span class="no">object</span>)</pre></body></html></div>
<p><img src="bcbioRNASeq_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
<div class="sourceCode" id="cb41"><html><body><pre class="r"><span class="fu"><a href="../reference/plotMappedReads.html">plotMappedReads</a></span>(<span class="no">object</span>)</pre></body></html></div>
<p><img src="bcbioRNASeq_files/figure-html/unnamed-chunk-18-2.png" width="700"></p>
</div>
<div id="mapping-rates" class="section level2">
<h2 class="hasAnchor">
<a href="#mapping-rates" class="anchor"></a>Mapping rates</h2>
<p>Note that the overall mapping rate is relatively low per sample, while the exonic mapping rate is acceptable. High quality samples should have low intronic mapping rate, and high values are indicative of sample degradation and/or contamination.</p>
<div class="sourceCode" id="cb42"><html><body><pre class="r"><span class="fu"><a href="../reference/plotMappingRate.html">plotMappingRate</a></span>(<span class="no">object</span>)</pre></body></html></div>
<p><img src="bcbioRNASeq_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
<div class="sourceCode" id="cb43"><html><body><pre class="r"><span class="fu"><a href="../reference/plotExonicMappingRate.html">plotExonicMappingRate</a></span>(<span class="no">object</span>)</pre></body></html></div>
<p><img src="bcbioRNASeq_files/figure-html/unnamed-chunk-19-2.png" width="700"></p>
<div class="sourceCode" id="cb44"><html><body><pre class="r"><span class="fu"><a href="../reference/plotIntronicMappingRate.html">plotIntronicMappingRate</a></span>(<span class="no">object</span>)</pre></body></html></div>
<p><img src="bcbioRNASeq_files/figure-html/unnamed-chunk-19-3.png" width="700"></p>
</div>
<div id="rrna-mapping-rate" class="section level2">
<h2 class="hasAnchor">
<a href="#rrna-mapping-rate" class="anchor"></a>rRNA mapping rate</h2>
<p>Note that the samples here have a high rRNA mapping rate. This can be indicative of the polyA enrichment or ribo depletion protocol not having removed all ribosomal RNA (rRNA) transcripts. This will reduce the number of biologically meaningful reads in the experiment and is best avoided.</p>
<div class="sourceCode" id="cb45"><html><body><pre class="r"><span class="fu"><a href="../reference/plotRRNAMappingRate.html">plotRRNAMappingRate</a></span>(<span class="no">object</span>)</pre></body></html></div>
<p><img src="bcbioRNASeq_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
</div>
<div id="bias" class="section level2">
<h2 class="hasAnchor">
<a href="#bias" class="anchor"></a>5’-&gt;3’ bias</h2>
<p>RNA-seq data can have specific biases at either the 5’ or 3’ end of sequenced fragments. It is common to see a small amount of bias, especially if polyA enrichment was performed, or if there is any sample degradation. If a large amount of bias is observed here, be sure to analyze the samples with a Bioanalyzer and check the RIN scores.</p>
<div class="sourceCode" id="cb46"><html><body><pre class="r"><span class="fu"><a href="../reference/plot5Prime3PrimeBias.html">plot5Prime3PrimeBias</a></span>(<span class="no">object</span>)</pre></body></html></div>
<p><img src="bcbioRNASeq_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
</div>
<div id="gene-distributions" class="section level2">
<h2 class="hasAnchor">
<a href="#gene-distributions" class="anchor"></a>Gene distributions</h2>
<div class="sourceCode" id="cb47"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/acidgenerics/man/plotFeaturesDetected.html">plotFeaturesDetected</a></span>(<span class="no">object</span>)</pre></body></html></div>
<p><img src="bcbioRNASeq_files/figure-html/unnamed-chunk-22-1.png" width="700"></p>
<div class="sourceCode" id="cb48"><html><body><pre class="r"><span class="fu"><a href="../reference/plotGeneSaturation.html">plotGeneSaturation</a></span>(<span class="no">object</span>)</pre></body></html></div>
<p><img src="bcbioRNASeq_files/figure-html/unnamed-chunk-22-2.png" width="700"></p>
<div class="sourceCode" id="cb49"><html><body><pre class="r"><span class="fu"><a href="../reference/plotCountsPerFeature.html">plotCountsPerFeature</a></span>(<span class="no">object</span>, <span class="kw">geom</span> <span class="kw">=</span> <span class="st">"boxplot"</span>)</pre></body></html></div>
<p><img src="bcbioRNASeq_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
<div class="sourceCode" id="cb50"><html><body><pre class="r"><span class="fu"><a href="../reference/plotCountsPerFeature.html">plotCountsPerFeature</a></span>(<span class="no">object</span>, <span class="kw">geom</span> <span class="kw">=</span> <span class="st">"density"</span>)</pre></body></html></div>
<p><img src="bcbioRNASeq_files/figure-html/unnamed-chunk-23-2.png" width="700"></p>
</div>
<div id="sample-similarity" class="section level2">
<h2 class="hasAnchor">
<a href="#sample-similarity" class="anchor"></a>Sample similarity</h2>
<p>We can visualize sample similarity with principal component analysis (PCA) and hierarchical clustering of sample correlations. These functions support multiple normalization methods with the <code>normalized</code> argument.</p>
<div class="sourceCode" id="cb51"><html><body><pre class="r"><span class="fu"><a href="../reference/plotPCA.html">plotPCA</a></span>(<span class="no">object</span>)</pre></body></html></div>
<p><img src="bcbioRNASeq_files/figure-html/unnamed-chunk-24-1.png" width="700"></p>
<div class="sourceCode" id="cb52"><html><body><pre class="r"><span class="fu"><a href="../reference/plotCorrelationHeatmap.html">plotCorrelationHeatmap</a></span>(<span class="no">object</span>)</pre></body></html></div>
<p><img src="bcbioRNASeq_files/figure-html/unnamed-chunk-24-2.png" width="700"></p>
</div>
</div>
<div id="export" class="section level1">
<h1 class="hasAnchor">
<a href="#export" class="anchor"></a>Export</h1>
<p>The <code>counts</code> accessor function returns raw counts by default. Multiple normalization methods are accessible with the <code>normalized</code> argument.</p>
<div class="sourceCode" id="cb53"><html><body><pre class="r"><span class="no">raw_counts</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/counts.html">counts</a></span>(<span class="no">object</span>, <span class="kw">normalized</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="no">normalized_counts</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/counts.html">counts</a></span>(<span class="no">object</span>, <span class="kw">normalized</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">tpm</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/counts.html">counts</a></span>(<span class="no">object</span>, <span class="kw">normalized</span> <span class="kw">=</span> <span class="st">"tpm"</span>)
<span class="no">log2_vst_counts</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/counts.html">counts</a></span>(<span class="no">object</span>, <span class="kw">normalized</span> <span class="kw">=</span> <span class="st">"vst"</span>)</pre></body></html></div>
<p>We are providing <code>bcbioRNASeq</code> method support for the <code>export</code> function, which automatically exports matrices defined in <code>assays</code> and corresponding metadata (e.g. <code>rowData</code>, <code>colData</code>) to disk in a single call.</p>
<div class="sourceCode" id="cb54"><html><body><pre class="r"><span class="no">files</span> <span class="kw">&lt;-</span> <span class="fu">export</span>(<span class="no">object</span>)
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">files</span>)</pre></body></html></div>
<pre><code>## $assays
## $assays$counts
## [1] "/Users/mike/git/monorepo/r-packages/bcbioRNASeq/vignettes/object/assays/counts.csv"
## 
## $assays$tpm
## [1] "/Users/mike/git/monorepo/r-packages/bcbioRNASeq/vignettes/object/assays/tpm.csv"
## 
## $assays$avgTxLength
## [1] "/Users/mike/git/monorepo/r-packages/bcbioRNASeq/vignettes/object/assays/avgTxLength.csv"
## 
## $assays$normalized
## [1] "/Users/mike/git/monorepo/r-packages/bcbioRNASeq/vignettes/object/assays/normalized.csv"
## 
## $assays$rlog
## [1] "/Users/mike/git/monorepo/r-packages/bcbioRNASeq/vignettes/object/assays/rlog.csv"
## 
## $assays$vst
## [1] "/Users/mike/git/monorepo/r-packages/bcbioRNASeq/vignettes/object/assays/vst.csv"
## 
## 
## $colData
## [1] "/Users/mike/git/monorepo/r-packages/bcbioRNASeq/vignettes/object/colData.csv"
## 
## $rowData
## [1] "/Users/mike/git/monorepo/r-packages/bcbioRNASeq/vignettes/object/rowData.csv"</code></pre>
</div>
<div id="differential-expression" class="section level1">
<h1 class="hasAnchor">
<a href="#differential-expression" class="anchor"></a>Differential expression</h1>
<p>bcbioRNASeq integrates with <a href="https://bioconductor.org/packages/DESeq2/">DESeq2</a> and <a href="https://bioconductor.org/packages/edgeR/">edgeR</a> for differential expression.</p>
<div id="deseq2" class="section level2">
<h2 class="hasAnchor">
<a href="#deseq2" class="anchor"></a>DESeq2</h2>
<p>To prepare our dataset for analysis, we need to coerce the <code>bcbioRNASeq</code> object to a <code>DESeqDataSet</code>. We have defined an S4 coercion method that uses the <code>as</code> function in the package.</p>
<div class="sourceCode" id="cb56"><html><body><pre class="r"><span class="no">dds</span> <span class="kw">&lt;-</span> <span class="fu">as</span>(<span class="no">object</span>, <span class="st">"DESeqDataSet"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">dds</span>)</pre></body></html></div>
<pre><code>## class: DESeqDataSet 
## dim: 51652 12 
## metadata(11): version caller ... date sessionInfo
## assays(1): counts
## rownames(51652): ENSMUSG00000000001 ENSMUSG00000000003 ...
##   ENSMUSG00000114967 ENSMUSG00000114968
## rowData names(7): geneID geneName ... entrezID broadClass
## colnames(12): control_rep1 control_rep2 ... fa_day7_rep2 fa_day7_rep3
## colData names(25): sampleName day ... x5x3Bias xGC</code></pre>
<p>Since both <code>bcbioRNASeq</code> and <code>DESeqDataSet</code> classes extend <code>RangedSummarizedExperiment</code>, internally we coerce the original <code>bcbioRNASeq</code> object to a <code>RangedSummarizedExperiment</code> and then use the <code>DESeqDataSet</code> constructor, which requires a <code>SummarizedExperiment</code> with integer counts.</p>
<p>The source code for our <code>bcbioRNASeq</code> to <code>DESeqDataSet</code> coercion is accessible with <code>getMethod</code>.</p>
<div class="sourceCode" id="cb58"><html><body><pre class="r"><span class="fu">getMethod</span>(
    <span class="kw">f</span> <span class="kw">=</span> <span class="st">"coerce"</span>,
    <span class="kw">signature</span> <span class="kw">=</span> <span class="fu">signature</span>(<span class="kw">from</span> <span class="kw">=</span> <span class="st">"bcbioRNASeq"</span>, <span class="kw">to</span> <span class="kw">=</span> <span class="st">"DESeqDataSet"</span>)
)</pre></body></html></div>
<p>We also provide a parameterized starter R Markdown template for standard DESeq2 differential expression, supporting analysis and visualization of multiple contrasts inside a single report. In our workflow paper, we also describe an example LRT analysis.</p>
<p>Now you can perform differential expression analysis with DESeq2. The authors of that package have provided a number of detailed, well documented references online:</p>
<ul>
<li>
<a href="http://bioconductor.org/packages/devel/bioc/vignettes/DESeq2/inst/doc/DESeq2.html">Analyzing RNA-seq data with DESeq2</a>.</li>
<li>
<a href="http://dx.doi.org/10.12688/f1000research.7035.2">RNA-Seq workflow: gene-level exploratory analysis and differential expression</a>.</li>
<li>
<a href="https://f1000research.com/articles/4-1521/v2">Differential analyses for RNA-seq: transcript-level estimates improve gene-level inferences</a>.</li>
</ul>
</div>
<div id="edger" class="section level2">
<h2 class="hasAnchor">
<a href="#edger" class="anchor"></a>edgeR</h2>
<p>To prepare our dataset for analysis, we need to coerce the <code>bcbioRNASeq</code> object to a <code>DGEList</code>. Similar to our DESeq2 approach, we have defined an S4 coercion method that hands off to <a href="https://bioconductor.org/packages/edgeR/">edgeR</a>.</p>
<div class="sourceCode" id="cb59"><html><body><pre class="r"><span class="no">dge</span> <span class="kw">&lt;-</span> <span class="fu">as</span>(<span class="no">object</span>, <span class="st">"DGEList"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">dge</span>)</pre></body></html></div>
<pre><code>##         Length Class      Mode   
## counts  619824 -none-     numeric
## samples      3 data.frame list</code></pre>
<p>The source code for our <code>bcbioRNASeq</code> to <code>DGEList</code> coercion is accessible with <code>getMethod</code>.</p>
<div class="sourceCode" id="cb61"><html><body><pre class="r"><span class="fu">getMethod</span>(
    <span class="kw">f</span> <span class="kw">=</span> <span class="st">"coerce"</span>,
    <span class="kw">signature</span> <span class="kw">=</span> <span class="fu">signature</span>(<span class="kw">from</span> <span class="kw">=</span> <span class="st">"bcbioRNASeq"</span>, <span class="kw">to</span> <span class="kw">=</span> <span class="st">"DGEList"</span>)
)</pre></body></html></div>
</div>
</div>
<div id="functional-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#functional-analysis" class="anchor"></a>Functional analysis</h1>
<p>We provide a starter R Markdown template for <a href="http://software.broadinstitute.org/gsea/">gene set enrichment analysis (GSEA)</a> and <a href="https://www.genome.jp/kegg/">Kyoto Encyclopedia of Genes and Genomes (KEGG)</a> pathway enrichment analysis <span class="citation">(Kanehisa and Goto 2000; Subramanian et al. 2005)</span>, which leverages the functionality of the <a href="https://bioconductor.org/packages/clusterProfiler/">clusterProfiler</a> package <span class="citation">(Yu et al. 2012)</span>. This workflow is described in detail in our workflow paper, and is outside the scope of this advanced use vignette. For more information on functional analysis, consult the <a href="https://bioconductor.org/packages/clusterProfiler/">clusterProfiler</a> vignette or Stephen Turner’s excellent <a href="https://stephenturner.github.io/deseq-to-fgsea/">DESeq2 to fgsea workflow</a>.</p>
</div>
<div id="r-session-information" class="section level1">
<h1 class="hasAnchor">
<a href="#r-session-information" class="anchor"></a>R session information</h1>
<div class="sourceCode" id="cb62"><html><body><pre class="r"><span class="kw pkg">utils</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span>()</pre></body></html></div>
<pre><code>## R version 4.0.2 (2020-06-22)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Catalina 10.15.5
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRblas.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] parallel  stats4    stats     graphics  grDevices utils     datasets 
## [8] methods   base     
## 
## other attached packages:
##  [1] bcbioRNASeq_0.3.34          basejump_0.12.8            
##  [3] SummarizedExperiment_1.18.1 DelayedArray_0.14.0        
##  [5] matrixStats_0.56.0          Biobase_2.48.0             
##  [7] GenomicRanges_1.40.0        GenomeInfoDb_1.24.2        
##  [9] IRanges_2.22.2              S4Vectors_0.26.1           
## [11] BiocGenerics_0.34.0         BiocStyle_2.16.0           
## 
## loaded via a namespace (and not attached):
##   [1] backports_1.1.8               AnnotationHub_2.20.0         
##   [3] BiocFileCache_1.12.0          plyr_1.8.6                   
##   [5] lazyeval_0.2.2                splines_4.0.2                
##   [7] BiocParallel_1.22.0           pipette_0.4.7                
##   [9] ggplot2_3.3.2                 digest_0.6.25                
##  [11] ensembldb_2.12.1              htmltools_0.5.0              
##  [13] viridis_0.5.1                 fansi_0.4.1                  
##  [15] magrittr_1.5                  memoise_1.1.0                
##  [17] syntactic_0.4.0               limma_3.44.3                 
##  [19] readr_1.3.1                   Biostrings_2.56.0            
##  [21] annotate_1.66.0               R.utils_2.9.2                
##  [23] vroom_1.2.1                   askpass_1.1                  
##  [25] pkgdown_1.5.1                 prettyunits_1.1.1            
##  [27] colorspace_1.4-1              blob_1.2.1                   
##  [29] rappdirs_0.3.1                ggrepel_0.8.2                
##  [31] xfun_0.15                     dplyr_1.0.0                  
##  [33] jsonlite_1.7.0                crayon_1.3.4                 
##  [35] RCurl_1.98-1.2                acidbase_0.1.10              
##  [37] tximport_1.16.1               genefilter_1.70.0            
##  [39] survival_3.2-3                glue_1.4.1                   
##  [41] gtable_0.3.0                  zlibbioc_1.34.0              
##  [43] XVector_0.28.0                UpSetR_1.4.0                 
##  [45] SingleCellExperiment_1.10.1   scales_1.1.1                 
##  [47] pheatmap_1.0.12               DBI_1.1.0                    
##  [49] edgeR_3.30.3                  Rcpp_1.0.5                   
##  [51] viridisLite_0.3.0             xtable_1.8-4                 
##  [53] progress_1.2.2                acidgenerics_0.3.7           
##  [55] bit_1.1-15.2                  httr_1.4.1                   
##  [57] RColorBrewer_1.1-2            ellipsis_0.3.1               
##  [59] farver_2.0.3                  pkgconfig_2.0.3              
##  [61] XML_3.99-0.4                  R.methodsS3_1.8.0            
##  [63] dbplyr_1.4.4                  locfit_1.5-9.4               
##  [65] labeling_0.3                  tidyselect_1.1.0             
##  [67] rlang_0.4.6                   later_1.1.0.1                
##  [69] AnnotationDbi_1.50.1          munsell_0.5.0                
##  [71] BiocVersion_3.11.1            tools_4.0.2                  
##  [73] cli_2.0.2                     generics_0.0.2               
##  [75] RSQLite_2.2.0                 ggridges_0.5.2               
##  [77] evaluate_0.14                 stringr_1.4.0                
##  [79] fastmap_1.0.1                 yaml_2.2.1                   
##  [81] knitr_1.29                    bit64_0.9-7                  
##  [83] fs_1.4.2                      acidplots_0.2.28             
##  [85] bcbioBase_0.6.13              purrr_0.3.4                  
##  [87] AnnotationFilter_1.12.0       mime_0.9                     
##  [89] R.oo_1.23.0                   biomaRt_2.44.1               
##  [91] compiler_4.0.2                rstudioapi_0.11              
##  [93] curl_4.3                      interactiveDisplayBase_1.26.3
##  [95] tibble_3.0.2                  geneplotter_1.66.0           
##  [97] stringi_1.4.6                 GenomicFeatures_1.40.0       
##  [99] desc_1.2.0                    lattice_0.20-41              
## [101] ProtGenerics_1.20.0           Matrix_1.2-18                
## [103] vctrs_0.3.1                   pillar_1.4.4                 
## [105] lifecycle_0.2.0               BiocManager_1.30.10          
## [107] data.table_1.12.8             cowplot_1.0.0                
## [109] bitops_1.0-6                  httpuv_1.5.4                 
## [111] rtracklayer_1.48.0            R6_2.4.1                     
## [113] bookdown_0.20                 promises_1.1.1               
## [115] gridExtra_2.3                 sessioninfo_1.1.1            
## [117] MASS_7.3-51.6                 assertthat_0.2.1             
## [119] openssl_1.4.2                 DESeq2_1.28.1                
## [121] rprojroot_1.3-2               withr_2.2.0                  
## [123] GenomicAlignments_1.24.0      Rsamtools_2.4.0              
## [125] GenomeInfoDbData_1.2.3        hms_0.5.3                    
## [127] grid_4.0.2                    rmarkdown_2.3                
## [129] goalie_0.4.5                  shiny_1.5.0</code></pre>
</div>
<div id="references" class="section level1">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<p>The papers and software cited in our workflows are available as a <a href="https://paperpile.com/shared/e1q8fn">shared library</a> on <a href="https://paperpile.com/">Paperpile</a>.</p>
<div id="refs" class="references">
<div id="ref-Bray2016-me">
<p>Bray, Nicolas L, Harold Pimentel, Páll Melsted, and Lior Pachter. 2016. “Near-Optimal Probabilistic RNA-seq Quantification.” <em>Nat. Biotechnol.</em> 34 (5): 525–27. <a href="https://doi.org/10.1038/nbt.3519">https://doi.org/10.1038/nbt.3519</a>.</p>
</div>
<div id="ref-Craciun2016-ha">
<p>Craciun, Florin L, Vanesa Bijol, Amrendra K Ajay, Poornima Rao, Ramya K Kumar, John Hutchinson, Oliver Hofmann, et al. 2016. “RNA Sequencing Identifies Novel Translational Biomarkers of Kidney Fibrosis.” <em>J. Am. Soc. Nephrol.</em> 27 (6): 1702–13. <a href="https://doi.org/10.1681/ASN.2015020225">https://doi.org/10.1681/ASN.2015020225</a>.</p>
</div>
<div id="ref-Dobin2013-hr">
<p>Dobin, Alexander, Carrie A Davis, Felix Schlesinger, Jorg Drenkow, Chris Zaleski, Sonali Jha, Philippe Batut, Mark Chaisson, and Thomas R Gingeras. 2013. “STAR: Ultrafast Universal RNA-seq Aligner.” <em>Bioinformatics</em> 29 (1): 15–21. <a href="https://doi.org/10.1093/bioinformatics/bts635">https://doi.org/10.1093/bioinformatics/bts635</a>.</p>
</div>
<div id="ref-Dobin2016-qj">
<p>Dobin, Alexander, and Thomas R Gingeras. 2016. “Optimizing RNA-Seq Mapping with STAR.” <em>Methods Mol. Biol.</em> 1415: 245–62. <a href="https://doi.org/10.1007/978-1-4939-3572-7%5C_13">https://doi.org/10.1007/978-1-4939-3572-7\_13</a>.</p>
</div>
<div id="ref-Huber2015-nw">
<p>Huber, Wolfgang, Vincent J Carey, Robert Gentleman, Simon Anders, Marc Carlson, Benilton S Carvalho, Hector Corrada Bravo, et al. 2015. “Orchestrating High-Throughput Genomic Analysis with Bioconductor.” <em>Nat. Methods</em> 12 (2): 115–21. <a href="https://doi.org/10.1038/nmeth.3252">https://doi.org/10.1038/nmeth.3252</a>.</p>
</div>
<div id="ref-Kanehisa2000-hk">
<p>Kanehisa, M, and S Goto. 2000. “KEGG: Kyoto Encyclopedia of Genes and Genomes.” <em>Nucleic Acids Res.</em> 28 (1): 27–30. <a href="https://www.ncbi.nlm.nih.gov/pubmed/10592173">https://www.ncbi.nlm.nih.gov/pubmed/10592173</a>.</p>
</div>
<div id="ref-Kim2015-rr">
<p>Kim, Daehwan, Ben Langmead, and Steven L Salzberg. 2015. “HISAT: A Fast Spliced Aligner with Low Memory Requirements.” <em>Nat. Methods</em> 12 (4): 357–60. <a href="https://doi.org/10.1038/nmeth.3317">https://doi.org/10.1038/nmeth.3317</a>.</p>
</div>
<div id="ref-Lawrence2013-vz">
<p>Lawrence, Michael, Wolfgang Huber, Hervé Pagès, Patrick Aboyoun, Marc Carlson, Robert Gentleman, Martin T Morgan, and Vincent J Carey. 2013. “Software for Computing and Annotating Genomic Ranges.” <em>PLoS Comput. Biol.</em> 9 (8): e1003118. <a href="https://doi.org/10.1371/journal.pcbi.1003118">https://doi.org/10.1371/journal.pcbi.1003118</a>.</p>
</div>
<div id="ref-Liao2014-js">
<p>Liao, Yang, Gordon K Smyth, and Wei Shi. 2014. “FeatureCounts: An Efficient General Purpose Program for Assigning Sequence Reads to Genomic Features.” <em>Bioinformatics</em> 30 (7): 923–30. <a href="https://doi.org/10.1093/bioinformatics/btt656">https://doi.org/10.1093/bioinformatics/btt656</a>.</p>
</div>
<div id="ref-Love2014-sq">
<p>Love, Michael I, Wolfgang Huber, and Simon Anders. 2014. “Moderated Estimation of Fold Change and Dispersion for RNA-seq Data with DESeq2.” <em>Genome Biol.</em> 15 (12): 550. <a href="https://doi.org/10.1186/s13059-014-0550-8">https://doi.org/10.1186/s13059-014-0550-8</a>.</p>
</div>
<div id="ref-Patro2017-pi">
<p>Patro, Rob, Geet Duggal, Michael I Love, Rafael A Irizarry, and Carl Kingsford. 2017. “Salmon Provides Fast and Bias-Aware Quantification of Transcript Expression.” <em>Nat. Methods</em> 14 (4): 417–19. <a href="https://doi.org/10.1038/nmeth.4197">https://doi.org/10.1038/nmeth.4197</a>.</p>
</div>
<div id="ref-Patro2014-qz">
<p>Patro, Rob, Stephen M Mount, and Carl Kingsford. 2014. “Sailfish Enables Alignment-Free Isoform Quantification from RNA-seq Reads Using Lightweight Algorithms.” <em>Nat. Biotechnol.</em> 32 (5): 462–64. <a href="https://doi.org/10.1038/nbt.2862">https://doi.org/10.1038/nbt.2862</a>.</p>
</div>
<div id="ref-Soneson2016-tu">
<p>Soneson, Charlotte, Michael I Love, and Mark D Robinson. 2016. “Differential Analyses for RNA-seq: Transcript-Level Estimates Improve Gene-Level Inferences.” <em>F1000Res.</em> 4 (December). <a href="https://doi.org/10.12688/f1000research.7563.1">https://doi.org/10.12688/f1000research.7563.1</a>.</p>
</div>
<div id="ref-Steinbaugh2018-rc">
<p>Steinbaugh, Michael J, Lorena Pantano, Rory D Kirchner, Victor Barrera, Brad A Chapman, Mary E Piper, Meeta Mistry, et al. 2018. “bcbioRNASeq: R Package for Bcbio RNA-seq Analysis.” <em>F1000Res.</em> 6 (June). <a href="https://doi.org/10.12688/f1000research.12093.2">https://doi.org/10.12688/f1000research.12093.2</a>.</p>
</div>
<div id="ref-Subramanian2005-zk">
<p>Subramanian, Aravind, Pablo Tamayo, Vamsi K Mootha, Sayan Mukherjee, Benjamin L Ebert, Michael A Gillette, Amanda Paulovich, et al. 2005. “Gene Set Enrichment Analysis: A Knowledge-Based Approach for Interpreting Genome-Wide Expression Profiles.” <em>Proc. Natl. Acad. Sci. U. S. A.</em> 102 (43): 15545–50. <a href="https://doi.org/10.1073/pnas.0506580102">https://doi.org/10.1073/pnas.0506580102</a>.</p>
</div>
<div id="ref-Yu2012-ae">
<p>Yu, Guangchuang, Li-Gen Wang, Yanyan Han, and Qing-Yu He. 2012. “ClusterProfiler: An R Package for Comparing Biological Themes Among Gene Clusters.” <em>OMICS</em> 16 (5): 284–87. <a href="https://doi.org/10.1089/omi.2011.0118">https://doi.org/10.1089/omi.2011.0118</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://steinbaugh.com/">Michael Steinbaugh</a>, <a href="https://lpantano.github.io/">Lorena Pantano</a>, <a href="https://github.com/roryk/">Rory Kirchner</a>, <a href="https://github.com/vbarrera/">Victor Barrera</a>, <a href="https://github.com/chapmanb/">Brad Chapman</a>, <a href="https://github.com/marypiper/">Mary Piper</a>, <a href="https://github.com/mistrm82/">Meeta Mistry</a>, <a href="https://github.com/rkhetani/">Radhika Khetani</a>, <a href="https://github.com/KayleighRutherford/">Kayleigh Rutherford</a>, <a href="https://github.com/ohofmann/">Oliver Hofmann</a>, <a href="https://github.com/jnhutchinson/">John Hutchinson</a>, <a href="https://github.com/sjhosui/">Shannan Ho Sui</a>, <a href="https://bioinformatics.sph.harvard.edu/">Harvard Chan Bioinformatics Core</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
